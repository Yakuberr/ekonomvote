<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8">
  <title>Głosowanie</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Bootstrap 5 CDN -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" defer></script>
</head>
<body class="bg-light">

<div class="container my-4">
  <h1 class="h3 mb-3">Wybierz swoich kandydatów</h1>
  <p class="text-muted mb-4">Możesz zagłosować maksymalnie na <strong id="limitValue">3</strong> kandydatów.</p>

  <!-- Accordion -->
  <div class="accordion" id="candidatesAccordion"></div>

  <!-- Głosów -->
  <div class="mt-4 text-center">
    <p>Oddano <span id="voteCount">0</span> / <span id="voteLimit">3</span> głosów</p>
  </div>
</div>

<script>
  const voteLimit = 3;
  const voteCountEl = document.getElementById('voteCount');
  const voteLimitEl = document.getElementById('voteLimit');
  voteLimitEl.textContent = voteLimit;

  const candidates = [
    {
      id: 1,
      name: "Anna Nowak",
      class: "3A",
      image: "https://randomuser.me/api/portraits/women/68.jpg",
      program: "Lepsza stołówka, więcej wycieczek, krótsze lekcje",
      selected: false
    },
    {
      id: 2,
      name: "Jan Kowalski",
      class: "2B",
      image: "https://randomuser.me/api/portraits/men/22.jpg",
      program: "Turniej FIFA, lody w piątki, darmowe Wi-Fi",
      selected: false
    },
    {
      id: 3,
      name: "Maria Wiśniewska",
      class: "1C",
      image: "https://randomuser.me/api/portraits/women/10.jpg",
      program: "Zielona szkoła, godziny wychowawcze z pizzą",
      selected: false
    },
  ];

  const accordionContainer = document.getElementById('candidatesAccordion');

  function updateVoteCount() {
    const selected = candidates.filter(c => c.selected).length;
    voteCountEl.textContent = selected;
    document.querySelectorAll('.vote-btn').forEach(btn => {
      const isSelected = btn.dataset.selected === 'true';
      const disabled = !isSelected && selected >= voteLimit;
      btn.disabled = disabled;
    });
  }

  function renderAccordion() {
    accordionContainer.innerHTML = '';
    candidates.forEach((c, i) => {
      const item = document.createElement('div');
      item.className = 'accordion-item mb-2';

      item.innerHTML = `
        <h2 class="accordion-header" id="heading${c.id}">
          <button class="accordion-button collapsed d-flex align-items-center gap-3" type="button" data-bs-toggle="collapse" data-bs-target="#collapse${c.id}" aria-expanded="false" aria-controls="collapse${c.id}">
            <img src="${c.image}" alt="Zdjęcie ${c.name}" class="rounded" width="50" height="50">
            <div>
              <strong>${c.name}</strong><br>
              <small class="text-muted">klasa ${c.class}</small>
            </div>
          </button>
        </h2>
        <div id="collapse${c.id}" class="accordion-collapse collapse" aria-labelledby="heading${c.id}" data-bs-parent="#candidatesAccordion">
          <div class="accordion-body">
            <p class="mb-2">${c.program}</p>
            <button
              class="btn btn-sm vote-btn ${c.selected ? 'btn-danger' : 'btn-primary'}"
              data-id="${c.id}"
              data-selected="${c.selected}"
            >
              ${c.selected ? 'Usuń głos' : 'Zagłosuj'}
            </button>
          </div>
        </div>
      `;
      accordionContainer.appendChild(item);
    });

    // Eventy
    document.querySelectorAll('.vote-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        const id = parseInt(btn.dataset.id);
        const candidate = candidates.find(c => c.id === id);
        candidate.selected = !candidate.selected;
        renderAccordion();
        updateVoteCount();
      });
    });

    updateVoteCount();
  }

  renderAccordion();
</script>

</body>
</html>
